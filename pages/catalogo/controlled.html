<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controlled Insanity</title>
    <link rel="stylesheet" href="../../styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <header>
        <h1>Controlled Insanity</h1>
    </header>
    <div id="modal">
        <div id="modal-content">
            <button class="modal-close-btn" onclick="cerrarModal()">×</button>
    
            <!-- Contenedor de imagen principal y su descripción -->
            <div id="main-img-container">
                <img id="main-img" src="" alt="">
                <div id="modal-desc" class="descripcion"></div>
            </div>
    
            <!-- Contenedor de miniaturas -->
            <div class="modal-img-container" id="modal-img-container">
                <!-- Aquí se insertarán las miniaturas dinámicamente -->
            </div>
    
            <!-- Contenedor de opciones (cantidad, talla, comprar) -->
            <div id="modal-options">
                <div class="cantidad">
                    <label for="cantidad">Cantidad:</label>
                    <select id="cantidad">
                        <!-- Opciones de 1 a 10 -->
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                    </select>
                </div>
    
                <div class="talla">
                    <div class="tallas-container">
                        <button class="talla-option" data-talla="S" onclick="seleccionarTalla(this)">Small</button>
                        <button class="talla-option" data-talla="M" onclick="seleccionarTalla(this)">Medium</button>
                        <button class="talla-option" data-talla="L" onclick="seleccionarTalla(this)">Large</button>
                        <button class="talla-option" data-talla="XL" onclick="seleccionarTalla(this)">XLarge</button>
                    </div>
                </div>
    
                <button class="cat-add-to-cart" onclick="comprarProducto()">Comprar</button>
            </div>
        </div>
    </div>
    <nav>
        <button class="hamburger-menu" onclick="toggleMenu()">
            <i class="fa fa-bars"></i>
        </button>
        <img src="../../Images/logo1.png" alt="logo" class="nav-logo">
        <div class="off-canvas-menu" id="menu">
            <a href="#" class="close-btn" onclick="toggleMenu()">×</a>
            <a href="../../index.html">Inicio</a>
            <a href="gymshark.html">Gymshark</a>
            <a href="youngla.html">Youngla</a>
            <a href="controlled.html">Controlled Insanity</a>
            <a href="../signIn.html">Iniciar sesion</a>
        </div>
        <div class="nav-links" id="menu">
            <a href="../../index.html">Inicio</a>
            <a href="gymshark.html">Gymshark</a>
            <a href="youngla.html">Youngla</a>
            <a href="controlled.html">Controlled Insanity</a>
            <a href="../signIn.html">
                <button class="boton-iniciar">
                    <i class="fa-solid fa-user"></i>
                </button>
            </a>
        </div>
        <button class="cart-icon" onclick="toggleCart()">
            <i class="fa fa-shopping-cart"></i>
        </button>
    </nav>
    <script>
        function toggleMenu() {
        const menu = document.getElementById("menu");
        menu.classList.toggle("show");
        }          
    </script>
    <!-- Carrito Off-Canvas -->
    <div id="cart-off-canvas" class="cart-off-canvas">
        <div class="off-canvas-header">
            <h2>Carrito</h2>
            <button class="close-button" onclick="toggleCart()">&times;</button>
        </div>
        <div class="off-canvas-content">
            <div class="empty-cart">
                <img src="../../Images/empty bag.png" alt="Carrito Vacío">
                <h3>Tu carrito está vacío</h3>
                <p>No has añadido ningún producto.</p>
                <a href="pages/catalogo/catalogo.html">
                    <button class="shop-button">Catalogo</button>
                </a>    
            </div>
        </div>
        <div class="cart-summary">
            <p>Subtotal: <span id="subtotal">$0.00</span></p>
            <p>IVA (15%): <span id="iva">$0.00</span></p>
            <p>Envío: <span id="envio">$0.00</span></p>
            <p><strong>Total: <span id="total">$0.00</span></strong></p>
            <button class="checkout-btn">Checkout</button>
            <p class="note">Envío gratuito en compras mayores a $100.</p>
        </div>
    </div>
    <div class="banner">
        <img src="../../Images/controlled/Controlled Insanity.png" alt="banner" class="banner-img">
        <div class="banner-content">
          <h2>PRODUCTOS CONTROLLED INSANITY</h2>
          <p style="color: white;">Todos los nuevos drops de controlled insanity disponibles en ATHLEX</p>
        </div>
    </div>

    <section class="cat-products">
        <div class="cat-product-card"> <!--1--> 
            <img src="../../Images/controlled/producto1.webp" alt="img1" 
            onclick="abrirModal('Controlled Insanity Pump Cover', 'Controlled Insanity Pump Cover', 
            ['../../Images/controlled/producto1.webp', '../../Images/controlled/producto1.1.webp', '../../Images/controlled/producto1.2.webp', '../../Images/controlled/producto1.3.webp', '../../Images/controlled/producto1.4.webp'])">
            <h2>Controlled Insanity Pump Cover</h2>
            <p>$55.00</p>
            
        </div>
        <div class="cat-product-card"> <!--2-->
            <img src="../../Images/controlled/producto2.webp" alt="img2"
                 onclick="abrirModal('Iron Therapy Pump Cover', 'Iron Therapy Pump Cover',
                 ['../../Images/controlled/producto2.webp', '../../Images/controlled/producto2.1.webp', '../../Images/controlled/producto2.2.webp', '../../Images/controlled/producto2.3.webp', '../../Images/controlled/producto2.4.webp'])">
            <h2>Iron Therapy Pump Cover</h2>
            <p>$55.00</p>
            
        </div>
        
        <div class="cat-product-card"> <!--3-->
            <img src="../../Images/controlled/producto3.webp" alt="img3"
                 onclick="abrirModal('Rag Tops', 'Rag Tops',
                 ['../../Images/controlled/producto3.webp', '../../Images/controlled/producto3.1.webp', '../../Images/controlled/producto3.2.webp', '../../Images/controlled/producto3.3.webp', '../../Images/controlled/producto3.4.webp'])">
            <h2>Rag Tops</h2>
            <p>$35.00</p>
            
        </div>
        
        <div class="cat-product-card"> <!--4-->
            <img src="../../Images/controlled/producto4.webp" alt="img4"
                 onclick="abrirModal('Scorpion Acid Wash Stringer', 'Scorpion Acid Wash Stringer',
                 ['../../Images/controlled/producto4.webp', '../../Images/controlled/producto4.1.webp', '../../Images/controlled/producto4.2.webp', '../../Images/controlled/producto4.3.webp', '../../Images/controlled/producto4.4.webp'])">
            <h2>Iron Therapy Heavyweight Tank Top</h2>
            <p>$35.00</p>
            
        </div>
        
        <div class="cat-product-card"> <!--5-->
            <img src="../../Images/controlled/producto5.webp" alt="img5"
                 onclick="abrirModal('Distressed Sweatpants', 'Distressed Sweatpants',
                 ['../../Images/controlled/producto5.webp', '../../Images/controlled/producto5.1.webp', '../../Images/controlled/producto5.2.webp', '../../Images/controlled/producto5.3.webp', '../../Images/controlled/producto5.4.webp'])">
            <h2>Distressed Sweatpants</h2>
            <p>$65.00</p>
            
        </div>
        
        <div class="cat-product-card"> <!--6-->
            <img src="../../Images/controlled/producto6.webp" alt="img6"
                 onclick="abrirModal('Tactical Scorpion Cargo', 'Tactical Scorpion Cargo',
                 ['../../Images/controlled/producto6.webp', '../../Images/controlled/producto6.1.webp', '../../Images/controlled/producto6.2.webp', '../../Images/controlled/producto6.3.webp', '../../Images/controlled/producto6.4.webp'])">
            <h2>Tactical Scorpion Cargo</h2>
            <p>$65.00</p>
            
        </div>
        
        <div class="cat-product-card"> <!--7-->
            <img src="../../Images/controlled/producto7.webp" alt="img7"
                 onclick="abrirModal('Track Jacket', 'Track Jacket',
                 ['../../Images/controlled/producto7.webp', '../../Images/controlled/producto7.1.webp', '../../Images/controlled/producto7.2.webp', '../../Images/controlled/producto7.3.webp', '../../Images/controlled/producto7.4.webp'])">
            <h2>Track Jacket</h2>
            <p>$50.00</p>
            
        </div>
        
        <div class="cat-product-card"> <!--8-->
            <img src="../../Images/controlled/producto8.webp" alt="img8"
                 onclick="abrirModal('Exclusive Oreo Pump Cover', 'Exclusive Oreo Pump Cover',
                 ['../../Images/controlled/producto8.webp', '../../Images/controlled/producto8.1.webp', '../../Images/controlled/producto8.2.webp', '../../Images/controlled/producto8.3.webp', '../../Images/controlled/producto8.4.webp'])">
            <h2>Exclusive Oreo Pump Cover</h2>
            <p>$60.00</p>
            
        </div>
        
        <div class="cat-product-card"> <!--9-->
            <img src="../../Images/controlled/producto9.webp" alt="img9"
                 onclick="abrirModal('Tactical Scorpion Hoodie', 'Tactical Scorpion Hoodie',
                 ['../../Images/controlled/producto9.webp', '../../Images/controlled/producto9.1.webp', '../../Images/controlled/producto9.2.webp', '../../Images/controlled/producto9.3.webp', '../../Images/controlled/producto9.4.webp'])">
            <h2>Tactical Scorpion Hoodie</h2>
            <p>$70.00</p>
            
        </div>
        
        <div class="cat-product-card"> <!--10-->
            <img src="../../Images/controlled/producto10.webp" alt="img10"
                 onclick="abrirModal('Rising Phoenix Cutoff', 'Rising Phoenix Cutoff',
                 ['../../Images/controlled/producto10.webp', '../../Images/controlled/producto10.1.webp', '../../Images/controlled/producto10.2.webp', '../../Images/controlled/producto10.3.webp', '../../Images/controlled/producto10.4.webp'])">
            <h2>Rising Phoenix Cutoff</h2>
            <p>$40.00</p>
            
        </div>
        
    </section>

    <footer>
        <p style="color:white;">&copy; 2024 SportShop. Todos los derechos reservados.</p>
    </footer>
    <button onclick="resetearCarrito()">Vaciar carrito</button>

    <script>
        let productoActual = '';
        let descripcionActual = '';
        let imagenesActuales = [];
        let imagenPrincipal = '';
        

        function abrirModal(nombreProducto, descripcion, imagenes) {
            productoActual = nombreProducto;
            descripcionActual = descripcion;
            imagenesActuales = imagenes;

            // Obtener el precio del producto desde el HTML de la tarjeta
            const productoCard = Array.from(document.querySelectorAll(".cat-product-card"))
                .find(card => card.querySelector("h2").textContent === nombreProducto);

            if (productoCard) {
                const precioTexto = productoCard.querySelector("p").textContent; // Buscar el texto del precio
                precioActual = parseFloat(precioTexto.replace('$', '')); // Convertir el precio a número
            } else {
                console.error("No se encontró el producto en el listado.");
                return;
            }

            // Mostrar el modal
            document.getElementById("modal").style.display = "flex";

            // Establecer la primera imagen como principal
            imagenPrincipal = imagenes[0];
            document.getElementById("main-img").src = imagenPrincipal;

            // Mostrar la descripción
            document.getElementById("modal-desc").textContent = descripcion;

            // Mostrar el precio en el modal (si es necesario añadirlo visualmente)
            const modalOptions = document.getElementById("modal-options");
            let modalPrice = document.getElementById("modal-price");
            if (!modalPrice) {
                modalPrice = document.createElement("p");
                modalPrice.id = "modal-price";
                modalPrice.style.fontWeight = "bold";
                modalPrice.style.marginBottom = "10px";
                modalOptions.insertBefore(modalPrice, modalOptions.firstChild);
            }
            modalPrice.textContent = `Precio: $${precioActual.toFixed(2)}`;

            // Generar las imágenes en miniatura
            const contenedorMiniaturas = document.getElementById("modal-img-container");
            contenedorMiniaturas.innerHTML = '';
            imagenes.forEach((imgSrc, index) => {
                const img = document.createElement("img");
                img.src = imgSrc;
                img.className = "modal-img" + (index === 0 ? " active" : "");
                img.onclick = function() {
                    seleccionarImagenPrincipal(imgSrc);
                };
                contenedorMiniaturas.appendChild(img);
            });
        }

        function seleccionarImagenPrincipal(src) {
            imagenPrincipal = src;
            document.getElementById("main-img").src = src;

            // Actualizar la clase activa en las miniaturas
            const miniaturas = document.querySelectorAll(".modal-img");
            miniaturas.forEach(img => img.classList.remove("active"));
            document.querySelector(`.modal-img[src="${src}"]`).classList.add("active");
        }

        function seleccionarTalla(elemento) {
        const tallas = document.querySelectorAll('.talla-option');
        tallas.forEach(talla => talla.classList.remove('active'));
        elemento.classList.add('active');
        // Puedes usar el atributo data-talla para obtener el valor seleccionado
        const tallaSeleccionada = elemento.getAttribute('data-talla');
        console.log('Talla seleccionada:', tallaSeleccionada);
        }

        function cerrarModal() {
            document.getElementById("modal").style.display = "none";
        }


        let carrito = [];

        document.addEventListener("DOMContentLoaded", cargarCarrito);

        function cargarCarrito() {
            const carritoGuardado = localStorage.getItem("carrito");
            if (carritoGuardado) {
                carrito = JSON.parse(carritoGuardado); // Convertir el JSON en un array
            } else {
                carrito = []; // Inicializar como vacío si no existe
            }
            actualizarCarrito(); // Actualiza la visualización del carrito
        }

        // Función para agregar productos al carrito
        function comprarProducto() {
            const cantidad = parseInt(document.getElementById("cantidad").value);
            const tallaBotonSeleccionado = document.querySelector(".talla-option.active");
            if (!tallaBotonSeleccionado) {
                alert("Por favor, selecciona una talla.");
                return;
            }

            const talla = tallaBotonSeleccionado.getAttribute("data-talla");
            alert(`Has comprado ${cantidad} unidad(es) de ${productoActual} en talla ${talla} :)`);
            
            // Datos del producto
            const producto = {
                nombre: productoActual,
                descripcion: descripcionActual,
                imagen: imagenPrincipal,
                cantidad: cantidad,
                talla: talla,
                precio: precioActual, // Ajusta el precio según el producto
            };

            carrito.push(producto); // Agregar producto al carrito
            cerrarModal(); // Cierra el modal
            actualizarCarrito(); // Actualiza el carrito visualmente
            guardarCarrito(); // Guarda el carrito en localStorage
        }

        const envioFijo = 5;
        const envioGratisLimite = 100;
        const ivaPorcentaje = 0.15;

        function toggleCart() {
            const cart = document.getElementById("cart-off-canvas");
            cart.classList.toggle("open");
            actualizarCarrito();
        }

        function agregarProducto(nombre, precio, imagen) {
            const productoExistente = carrito.find(p => p.nombre === nombre);
            if (productoExistente) {
                productoExistente.cantidad++;
            } else {
                carrito.push({ nombre, precio, imagen, cantidad: 1 });
            }
            actualizarCarrito();
        }

        function eliminarProducto(nombre) {
            carrito = carrito.filter(p => p.nombre !== nombre);
            actualizarCarrito();
            guardarCarrito(); // Guarda los cambios en localStorage
        }
        function guardarCarrito() {
            console.log("Guardando carrito en localStorage:", carrito);
            localStorage.setItem("carrito", JSON.stringify(carrito));
        }

        function actualizarCarrito() {
            const contenido = document.querySelector(".off-canvas-content");
            const resumen = document.querySelector(".cart-summary");

            // Vaciar el contenido del carrito
            contenido.innerHTML = "";

            if (carrito.length === 0) {
                // Mostrar mensaje de carrito vacío
                contenido.innerHTML = `
                    <div class="empty-cart">
                        <img src="../../Images/empty bag.png" alt="Carrito Vacío">
                        <h3>Tu carrito está vacío</h3>
                        <p>No has añadido ningún producto.</p>
                        <a href="pages/catalogo/catalogo.html">
                            <button class="shop-button">Catálogo</button>
                        </a>
                    </div>`;
                resumen.style.display = "none";
                return;
            }

            // Mostrar productos en el carrito
            let subtotal = 0;
            carrito.forEach(producto => {
                subtotal += producto.precio * producto.cantidad;

                const item = document.createElement("div");
                item.className = "cart-item";
                item.innerHTML = `
                    <img src="${producto.imagen}" alt="${producto.nombre}">
                    <div class="cart-item-details">
                        <h4>${producto.nombre}</h4>
                        <p>Cantidad: X${producto.cantidad}</p>
                        <p>Precio: $${(producto.precio * producto.cantidad).toFixed(2)}</p>
                    </div>
                    <div class="cart-item-actions">
                        <button onclick="eliminarProducto('${producto.nombre}')">
                            <i class="fa fa-trash"></i>
                        </button>
                    </div>`;
                contenido.appendChild(item);
            });

            // Calcular totales
            const iva = subtotal * ivaPorcentaje; // IVA es 15% (variable global)
            const envio = subtotal >= envioGratisLimite ? 0 : envioFijo; // Envío gratis si supera el límite
            const total = subtotal + iva + envio;

            // Actualizar los totales en el resumen
            document.getElementById("subtotal").textContent = `$${subtotal.toFixed(2)}`;
            document.getElementById("iva").textContent = `$${iva.toFixed(2)}`;
            document.getElementById("envio").textContent = `$${envio.toFixed(2)}`;
            document.getElementById("total").textContent = `$${total.toFixed(2)}`;

            resumen.style.display = "block"; // Mostrar el resumen si hay productos
        }

        window.addEventListener("storage", function(event) {
            if (event.key === "carrito") {
                console.log("Evento storage detectado:", event.newValue);
                carrito = JSON.parse(event.newValue || "[]");
                actualizarCarrito();
            }
        });
        function resetearCarrito() {
            carrito = []; // Vaciar la variable del carrito
            actualizarCarrito(); // Actualizar la visualización del carrito
            localStorage.removeItem("carrito"); // Eliminar del almacenamiento local
            sessionStorage.removeItem("carrito"); // Eliminar del almacenamiento de sesión (si se usa)
            console.log("Carrito reseteado.");
        }


    </script>
</body>
</html>